function cookieCheck(){return!(!userid||!jwt)||(window.location.href=window.location.origin+"/",!1)}function redirect(e){window.location.href=window.location.origin+e}var userid=decodeURI($.cookie("userid")),jwt=decodeURI($.cookie("jwt")),name=decodeURI($.cookie("name")),phone=decodeURI($.cookie("phone")),email=decodeURI($.cookie("email")),salon=decodeURI($.cookie("salon")),ErrorModal=function(){function e(){n=$(".errormodal"),a=$(".errormodal .message"),o=$(".errormodal .dismiss"),o.click(function(){a.empty()})}function t(e){a.text(e),n.modal("show")}var n,a,o,i=$(".errormodalcontainer");!function(){i&&i.load("/templates/errormodal.tpl.html",function(){e()})}();return{populateMessage:t}}(),StylistProfile=function(){function e(e){if(0!==e){var t=50*(Math.round(2*e)/2).toFixed(1);$(".starbar").css("width",t)}else $(".ratingtitle").text("No Ratings Yet!"),$(".starbar").css("width",0)}function t(e){for(var t in e){$(".ratingscontainer .comments").append('<div class="starholder" id="star'+t+'"></div>');for(var n=0;n<e[t].stars;n++)$(".starholder#star"+t).append("&star;");$(".ratingscontainer .comments").append('<span class="comment">'+e[t].comment+"</span>")}}function n(){i.append('<div class="avatar"></div><span class="name">'+name+'</span><span class="phone">'+phone+'</span><span class="salon">'+salon+'</span><hr><div class="ratingscontainer">Fetching Rating<img src="/app/img/loading.gif"></div>'),$(".stylistprofile .avatar").css("background",'url("'+apiurl+"avatar/"+userid+'") no-repeat center')}function a(n){$(".ratingscontainer").empty(),$(".ratingscontainer").append('<span class="ratingtitle">5 Star Rating:</span><div class="rating"><div class="stargrid"><img src="/app/img/star.png"><img src="/app/img/star.png"><img src="/app/img/star.png"><img src="/app/img/star.png"><img src="/app/img/star.png"></div><div class="starbar"></div></div><hr><div class="comments"></div>'),e(n.total),t(n.raw)}function o(){var e={async:!0,crossDomain:!0,url:apiurl+"rating/"+userid,method:"GET",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,statusCode:{200:function(e,t){a(e)},400:function(e,t){ErrorModal.populateMessage(e.responseText)},401:function(e,t){redirect("/")},500:function(e,t){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(e)}var i=($(".stylistmodal"),$(".stylistprofile"));!function(){n()}();return{stylistRatingAJAX:o}}(),ClientAdd=function(){function e(){u.show()}function t(){u.hide()}function n(){$(".clientaddmodal .clientaddform input").each(function(){$(this).val("")}),s.text(""),$(".clientaddmodal .clientaddform .photothumb").css("background","none")}function a(){var e=new FormData;e.append("firstname",r.val()),e.append("lastname",l.val()),e.append("phone",c.val()),e.append("notes",s.text()),e.append("photo",PhotoUpload.getResizedImage(),"photo.jpg"),e.append("name",name);var a={async:!0,crossDomain:!0,url:apiurl+"client/add/"+userid,method:"POST",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,mimeType:"multipart/form-data",data:e,statusCode:{200:function(e,a){ClientList.clientListAJAX(),n(),i.modal("hide"),t()},400:function(e,n){t(),ErrorModal.populateMessage(e.responseText)},401:function(e,n){t(),ErrorModal.populateMessage(e.responseText)},500:function(e,n){t(),ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(a)}var o=$("main .clientaddbutton"),i=$(".clientaddmodal"),r=($(".clientaddmodal .clientaddform"),$(".clientaddmodal .clientaddform .firstname")),l=$(".clientaddmodal .clientaddform .lastname"),c=$(".clientaddmodal .clientaddform .phone"),s=$(".clientaddmodal .clientaddform .notes"),d=$(".clientaddmodal .clientaddsubmit"),p=$(".clientaddmodal .closemodal"),u=$(".clientaddmodal .savingclient");o.click(function(){i.modal("show")}),d.click(function(){e(),a()}),p.click(function(){console.log("pooop"),n()}),$(document).keypress(":input:not(textarea)",function(e){return 13!=e.keyCode});return{emptyAddForm:n,showLoading:e,hideLoading:t}}(),ClientMenu=function(){function e(){a.show(),o.animate({top:50},300),c.animate({opacity:1},300),o.addClass("open")}function t(){o.animate({top:50-o.height()},300,function(){a.hide()}),c.animate({opacity:0},300),o.removeClass("open")}function n(){o.hasClass("open")?o.css("top",50):o.css("top",50-o.height())}var a=$(".clientmenu"),o=$(".clientmenu .menuitems"),i=$(".clientmenu .profile"),r=$(".clientmenu .report"),l=$(".clientmenu .logout"),c=$(".clientmenu .menuoverlay"),s=$(".stylistmodal"),d=$(".reportmodal");c.click(function(){t()}),i.click(function(){s.modal("show"),StylistProfile.stylistRatingAJAX(),t()}),r.click(function(){d.modal("show"),t()}),l.click(function(){$.removeCookie("jwt",{path:"/"}),$.removeCookie("userid",{path:"/"}),$.removeCookie("name",{path:"/"}),$.removeCookie("phone",{path:"/"}),$.removeCookie("email",{path:"/"}),$.removeCookie("salon",{path:"/"}),window.location.href=window.location.origin+"/"}),$(window).on("resize",function(){n()});return{openMenu:e,closeMenu:t}}(),ClientNav=function(){function e(){k.animate({left:"100vw"},500,function(){k.scrollTop(0)}),o(),n()}function t(){h.fadeOut(),g.hide()}function n(){h.fadeIn(),g.show()}function a(){v.fadeIn()}function o(){v.fadeOut()}function i(){var e=$(window).width()-40;f.fadeOut(300),m.fadeOut(300),w.fadeIn(300),p(),g.addClass("open"),h.animate({right:"+="+(e-10)+"px"},300,function(){g.show(),g.focus()})}function r(){g.blur();$(window).width();f.fadeIn(300),m.fadeIn(300),w.fadeOut(300),g.removeClass("open"),h.animate({right:"10px"},300,function(){d(),g.val(""),g.trigger("keyup")})}function l(){m.fadeIn(),f.fadeIn(),h.hide(),w.hide(),h.css("right","10px"),g.removeClass("open")}function c(){setTimeout(function(){g.val(""),g.trigger("keyup"),d()},300)}function s(){var e=$(window).width()-30;h.css("right",e-10)}function d(){$(".clientlist .letter").each(function(){$(this).fadeIn(300)})}function p(){$(".clientlist .letter").each(function(){$(this).fadeOut(300)})}function u(e,t){return-1!=e.toLowerCase().indexOf(t.toLowerCase())}var f=$(".clientnav .hamburger"),m=$(".clientnav .navlogo"),h=$(".clientnav .navsearch"),g=$(".clientnav .searchfield"),v=$(".clientnav .exitprofile"),w=$(".clientnav .cancelsearch"),C=$(".clientmenu .menuitems"),k=$(".clientprofile");f.click(function(){C.hasClass("open")?ClientMenu.closeMenu():ClientMenu.openMenu()}),v.click(function(){e(),C.hasClass("open")&&ClientMenu.closeMenu()}),g.click(function(){g.hasClass("open")?r():i(),C.hasClass("open")&&ClientMenu.closeMenu()}),$(window).on("resize",function(){g.hasClass("open")&&s()}),g.keyup(function(){var e=$(this).val();$(".clientlist .clientcard").each(function(){$(this).toggle(u($(this).data("name"),e))})}),w.click(function(){r()});return{hideSearch:t,showBackBtn:a,quickClearSearch:l,restoreList:c,closeClientProfile:e}}(),ClientProfile=function(){function e(e){var t=Math.floor(1e4*Math.random());a.attr("id",e._id),o.attr("src",apiurl+"photo/"+e.userid+"/"+e._id+"/avatar.jpg?dummy="+t),i.text(e.firstname),r.text(e.lastname),l.html('<a href="tel:'+e.phone+'">'+e.phone+"</a>"),c.attr("src",apiurl+"photo/"+e.userid+"/"+e._id+"/photo.jpg?dummy="+t),s.text(e.notes)}function t(){p.modal("show")}function n(){var e=a.attr("id"),t={async:!0,crossDomain:!0,url:apiurl+"client/delete/"+userid+"/"+e,method:"DELETE",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,statusCode:{200:function(e,t){ClientList.clientListAJAX(),ClientNav.closeClientProfile()},400:function(e,t){ErrorModal.populateMessage(e.responseText)},401:function(e,t){redirect("/")},500:function(e,t){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(t)}var a=$(".clientprofile"),o=$(".clientprofile .avatar"),i=$(".clientprofile .firstname"),r=$(".clientprofile .lastname"),l=$(".clientprofile .phone"),c=$(".clientprofile .photo"),s=$(".clientprofile .notes"),d=$(".clientprofile .deleteclient"),p=$(".deleteModal"),u=$(".deleteModal .confirmDelete");d.click(function(){t()}),u.click(function(){n()});return{populateProfile:e}}(),ClientList=function(){function e(){$(".clientcard").each(function(){$(this).click(function(){ClientProfile.populateProfile(clientlist[$(this).attr("id")]),ClientNav.quickClearSearch(),i.animate({left:"0"},500,function(){ClientNav.restoreList(),o.scrollTop(0)}),ClientNav.hideSearch(),ClientNav.showBackBtn()})})}function t(t){var a=Math.floor(1e4*Math.random());for(var i in t)n(t,i),o.append('<div class="clientcard" id="'+i+'" data-name="'+t[i].firstname+t[i].lastname+'"><div class="avatar"><img src="'+apiurl+"photo/"+userid+"/"+t[i]._id+"/avatar.jpg?dummy="+a+'"></div><span class="firstname">'+t[i].firstname+'</span><span class="lastname"> '+t[i].lastname+"</span></div>");e()}function n(e,t){"0"===t&&o.append('<div class="letter">'+e[t].firstname.charAt(0)+"</div>"),t>0&&t<e.length&&e[t].firstname.charAt(0)!==e[t-1].firstname.charAt(0)&&o.append('<div class="letter">'+e[t].firstname.charAt(0).toUpperCase()+"</div>")}function a(){var e={async:!0,crossDomain:!0,url:apiurl+"client/all/"+userid,method:"GET",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,statusCode:{200:function(e,n){clientlist=e,o.empty(),0===clientlist.length?o.append("<div class=\"empty\">You don't have any clients, <br> Click the '+' below to get started!</div>"):t(e)},400:function(e,t){ErrorModal.populateMessage(e.responseText)},401:function(e,t){redirect("/")},500:function(e,t){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(e)}var o=$(".clientlist"),i=$(".clientprofile");!function(){a()}();return{clientListAJAX:a}}(),ReportIssue=function(){function e(){var e=new FormData;e.append("name",name),e.append("phone",phone),e.append("email",email),e.append("salon",salon),e.append("issue",n.val());var t={async:!0,crossDomain:!0,url:"https://script.google.com/macros/s/AKfycbxwK0uSZtglD0qBQKwqNOzfM-1JDMjIusr4FL3i6bkpAkL-QCOH/exec",method:"POST",processData:!1,contentType:!1,data:e,statusCode:{200:function(e,t){},400:function(e,t){ErrorModal.populateMessage(e.responseText)},401:function(e,t){redirect("/")},500:function(e,t){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(t)}var t=($(".reportmodal"),$(".reportmodal .confirmreport")),n=$(".issueform");t.click(function(){e()});return{}}(),ClientEdit=function(){function e(){f.val(i),m.val(r),h.val(l),g.text(s),d.css("background","url("+c+") no-repeat center"),d.css("background-size","cover"),t(),u.modal("show")}function t(){v.hide(),w.hide(),C.show(),k.show()}function n(){v.show(),w.show(),C.hide(),k.hide()}function a(){i=$(".clientprofile .firstname").text(),r=$(".clientprofile .lastname").text(),l=$(".clientprofile .phone").text(),c=$(".clientprofile .photo").attr("src"),s=$(".clientprofile .notes").text(),d=$(".clientaddmodal .clientaddform .photothumb"),e()}function o(){var e=new FormData;e.append("firstname",f.val()),e.append("lastname",m.val()),e.append("phone",h.val()),e.append("notes",g.text()),e.append("photo",PhotoUpload.getResizedImage(),"photo.jpg"),clientid=$(".clientprofile").attr("id");var t={async:!0,crossDomain:!0,url:apiurl+"client/edit/"+userid+"/"+clientid+"/",method:"PUT",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,mimeType:"multipart/form-data",data:e,statusCode:{200:function(e,t){ClientList.clientListAJAX(),ClientAdd.emptyAddForm(),u.modal("hide"),ClientAdd.hideLoading(),ClientNav.closeClientProfile(),n()},400:function(e,t){hideLoading(),ErrorModal.populateMessage(e.responseText)},401:function(e,t){hideLoading(),ErrorModal.populateMessage(e.responseText)},500:function(e,t){hideLoading(),ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(t)}var i,r,l,c,s,d,p=$(".clientprofile .editclient"),u=($("main .clientaddbutton"),$(".clientaddmodal")),f=($(".clientaddmodal .modal-footer"),$(".clientaddmodal .clientaddform"),$(".clientaddmodal .clientaddform .firstname")),m=$(".clientaddmodal .clientaddform .lastname"),h=$(".clientaddmodal .clientaddform .phone"),g=$(".clientaddmodal .clientaddform .notes"),v=$(".clientaddmodal .clientaddsubmit"),w=$(".clientaddmodal .closemodal"),C=$(".clientaddmodal .clienteditsubmit"),k=$(".clientaddmodal .closeeditmodal");$(".clientaddmodal .savingclient");p.click(function(){a()}),k.click(function(){n(),ClientAdd.emptyAddForm()}),C.click(function(){ClientAdd.showLoading(),o()});return{}}(),PhotoUpload=function(){function e(){s.click(function(){l.click(),n()})}function t(){l=$(".photowidget .photoinput"),c=$(".photowidget .photobox"),s=$(".photowidget .photothumb"),e()}function n(){l.change(function(e){a(this.files[0])})}function a(e){var t=window.location.href.split("/")[3];"clients"===t&&ImageTools.resize(e,{width:500,height:500},function(e,t){o(e)}),"register"===t&&ImageTools.resize(e,{width:200,height:200},function(e,t){o(e)})}function o(e){var t=new FileReader;t.onload=function(){var n=new Image;n.onload=function(){i(n,e)},n.src=t.result},t.readAsDataURL(e)}function i(e,t){e.height<e.width?(s.removeClass("default"),s.addClass("rotate")):(s.removeClass("rotate"),s.addClass("default")),s.css("background","url("+e.src+") no-repeat center"),s.css("background-size","cover");var n=new File([t],"photo.jpg",{type:"image/jpeg",lastModified:Date.now()});d=n}function r(){return d}var l,c,s,d,p=$(".photowidget");!function(){p&&p.load("/templates/photoupload.tpl.html",function(){t()})}();return{getResizedImage:r}}();