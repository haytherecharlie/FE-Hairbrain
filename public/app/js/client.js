function cookieCheck(){return!(!userid||!jwt)||(window.location.href=window.location.origin+"/",!1)}function redirect(t){window.location.href=window.location.origin+t}var jwt=decodeURI($.cookie("jwt")),user=JSON.parse(sessionStorage.getItem("user")),userid=user.id,name=user.name,phone=user.phone,email=user.email,salon=user.salon,avatar=user.avatar,ErrorModal=function(){function t(){n=$(".errormodal"),a=$(".errormodal .message"),i=$(".errormodal .dismiss"),i.click(function(){a.empty()})}function e(t){a.text(t),n.modal("show")}var n,a,i,o=$(".errormodalcontainer");!function(){o&&o.load("/templates/errormodal.tpl.html",function(){t()})}();return{populateMessage:e}}(),StylistProfile=function(){function t(t){if(0!==t){var e=50*(Math.round(2*t)/2).toFixed(1);$(".starbar").css("width",e)}else $(".ratingtitle").text("No Ratings Yet!"),$(".starbar").css("width",0)}function e(t){for(var e in t){$(".ratingscontainer .comments").append('<div class="starholder" id="star'+e+'"></div>');for(var n=0;n<t[e].stars;n++)$(".starholder#star"+e).append("&star;");$(".ratingscontainer .comments").append('<span class="comment">'+t[e].comment+"</span>")}}function n(){o.append('<div class="avatar"></div><span class="name">'+name+'</span><span class="phone">'+phone+'</span><span class="salon">'+salon+'</span><hr><div class="ratingscontainer">Fetching Rating<img src="/app/img/loading.gif"></div>'),$(".stylistprofile .avatar").css("background","url("+avatar+") no-repeat center")}function a(n){$(".ratingscontainer").empty(),$(".ratingscontainer").append('<span class="ratingtitle">5 Star Rating:</span><div class="rating"><div class="stargrid"><img src="/app/img/star.png"><img src="/app/img/star.png"><img src="/app/img/star.png"><img src="/app/img/star.png"><img src="/app/img/star.png"></div><div class="starbar"></div></div><hr><div class="comments"></div>'),t(n.total),e(n.raw)}function i(){var t={async:!0,crossDomain:!0,url:apiurl+"rating/"+userid,method:"GET",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,statusCode:{200:function(t,e){a(t)},400:function(t,e){ErrorModal.populateMessage(t.responseText)},401:function(t,e){redirect("/")},500:function(t,e){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(t)}var o=($(".stylistmodal"),$(".stylistprofile"));!function(){n()}();return{stylistRatingAJAX:i}}(),ClientAdd=function(){function t(){p.show()}function e(){p.hide()}function n(){$(".clientaddmodal .clientaddform input").each(function(){$(this).val("")}),s.text(""),$(".clientaddmodal .clientaddform .photothumb").attr("src","/app/img/photoholder.png")}function a(){var t=new FormData;t.append("firstname",r.val()),t.append("lastname",l.val()),t.append("phone",c.val()),t.append("notes",s.text()),t.append("name",name),t.append("photo",PhotoUpload.getResizedImage()),t.append("avatar",PhotoUpload.getResizedAvatar());var a={async:!0,crossDomain:!0,url:apiurl+"client/add/"+userid,method:"POST",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,mimeType:"multipart/form-data",data:t,statusCode:{200:function(t,a){ClientList.clientListAJAX(),n(),o.modal("hide"),e()},400:function(t,n){e(),ErrorModal.populateMessage(t.responseText)},401:function(t,n){e(),ErrorModal.populateMessage(t.responseText)},500:function(t,n){e(),ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(a)}var i=$("main .clientaddbutton"),o=$(".clientaddmodal"),r=($(".clientaddmodal .clientaddform"),$(".clientaddmodal .clientaddform .firstname")),l=$(".clientaddmodal .clientaddform .lastname"),c=$(".clientaddmodal .clientaddform .phone"),s=$(".clientaddmodal .clientaddform .notes"),d=$(".clientaddmodal .clientaddsubmit"),u=$(".clientaddmodal .closemodal"),p=$(".clientaddmodal .savingclient");i.click(function(){o.modal("show")}),d.click(function(){t(),a()}),u.click(function(){n()}),$(document).keypress(":input:not(textarea)",function(t){return 13!=t.keyCode});return{emptyAddForm:n,showLoading:t,hideLoading:e}}(),ClientMenu=function(){function t(){a.show(),i.animate({top:50},300),c.animate({opacity:1},300),i.addClass("open")}function e(){i.animate({top:50-i.height()},300,function(){a.hide()}),c.animate({opacity:0},300),i.removeClass("open")}function n(){i.hasClass("open")?i.css("top",50):i.css("top",50-i.height())}var a=$(".clientmenu"),i=$(".clientmenu .menuitems"),o=$(".clientmenu .profile"),r=$(".clientmenu .report"),l=$(".clientmenu .logout"),c=$(".clientmenu .menuoverlay"),s=$(".stylistmodal"),d=$(".reportmodal");c.click(function(){e()}),o.click(function(){s.modal("show"),StylistProfile.stylistRatingAJAX(),e()}),r.click(function(){d.modal("show"),e()}),l.click(function(){$.removeCookie("jwt",{path:"/"}),sessionStorage.removeItem("user"),window.location.href=window.location.origin+"/"}),$(window).on("resize",function(){n()});return{openMenu:t,closeMenu:e}}(),ClientNav=function(){function t(){M.animate({left:"100vw"},500,function(){M.scrollTop(0)}),i(),n()}function e(){h.fadeOut(),g.hide()}function n(){h.fadeIn(),g.show()}function a(){v.fadeIn()}function i(){v.fadeOut()}function o(){var t=$(window).width()-40;f.fadeOut(300),m.fadeOut(300),w.fadeIn(300),u(),g.addClass("open"),h.animate({right:"+="+(t-10)+"px"},300,function(){g.show(),g.focus()})}function r(){g.blur();$(window).width();f.fadeIn(300),m.fadeIn(300),w.fadeOut(300),g.removeClass("open"),h.animate({right:"10px"},300,function(){d(),g.val(""),g.trigger("keyup")})}function l(){m.fadeIn(),f.fadeIn(),h.hide(),w.hide(),h.css("right","10px"),g.removeClass("open")}function c(){setTimeout(function(){g.val(""),g.trigger("keyup"),d()},300)}function s(){var t=$(window).width()-30;h.css("right",t-10)}function d(){$(".clientlist .letter").each(function(){$(this).fadeIn(300)})}function u(){$(".clientlist .letter").each(function(){$(this).fadeOut(300)})}function p(t,e){return-1!=t.toLowerCase().indexOf(e.toLowerCase())}var f=$(".clientnav .hamburger"),m=$(".clientnav .navlogo"),h=$(".clientnav .navsearch"),g=$(".clientnav .searchfield"),v=$(".clientnav .exitprofile"),w=$(".clientnav .cancelsearch"),C=$(".clientmenu .menuitems"),M=$(".clientprofile");f.click(function(){C.hasClass("open")?ClientMenu.closeMenu():ClientMenu.openMenu()}),v.click(function(){t(),C.hasClass("open")&&ClientMenu.closeMenu()}),g.click(function(){g.hasClass("open")?r():o(),C.hasClass("open")&&ClientMenu.closeMenu()}),$(window).on("resize",function(){g.hasClass("open")&&s()}),g.keyup(function(){var t=$(this).val();$(".clientlist .clientcard").each(function(){$(this).toggle(p($(this).data("name"),t))})}),w.click(function(){r()});return{hideSearch:e,showBackBtn:a,quickClearSearch:l,restoreList:c,closeClientProfile:t}}(),ClientProfile=function(){function t(t){Math.floor(1e4*Math.random());a.attr("id",t._id),i.attr("src",t.avatar),o.text(t.firstname),r.text(t.lastname),l.html('<a href="tel:'+t.phone+'">'+t.phone+"</a>"),c.attr("src",t.photo),s.text(t.notes)}function e(){u.modal("show")}function n(){var t=a.attr("id"),e={async:!0,crossDomain:!0,url:apiurl+"client/delete/"+userid+"/"+t,method:"DELETE",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,statusCode:{200:function(t,e){ClientList.clientListAJAX(),ClientNav.closeClientProfile()},400:function(t,e){ErrorModal.populateMessage(t.responseText)},401:function(t,e){redirect("/")},500:function(t,e){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(e)}var a=$(".clientprofile"),i=$(".clientprofile .avatar"),o=$(".clientprofile .firstname"),r=$(".clientprofile .lastname"),l=$(".clientprofile .phone"),c=$(".clientprofile .photo"),s=$(".clientprofile .notes"),d=$(".clientprofile .deleteclient"),u=$(".deleteModal"),p=$(".deleteModal .confirmDelete");d.click(function(){e()}),p.click(function(){n()});return{populateProfile:t}}(),ClientList=function(){function t(){$(".clientcard").each(function(){$(this).click(function(){ClientProfile.populateProfile(clientlist[$(this).attr("id")]),ClientNav.quickClearSearch(),o.animate({left:"0"},500,function(){ClientNav.restoreList(),i.scrollTop(0)}),ClientNav.hideSearch(),ClientNav.showBackBtn()})})}function e(e){Math.floor(1e4*Math.random());for(var a in e)n(e,a),i.append('<div class="clientcard" id="'+a+'" data-name="'+e[a].firstname+e[a].lastname+'"><div class="avatar"><img src="'+e[a].avatar+'"></div><span class="firstname">'+e[a].firstname+'</span><span class="lastname"> '+e[a].lastname+"</span></div>");t()}function n(t,e){"0"===e&&i.append('<div class="letter">'+t[e].firstname.charAt(0)+"</div>"),e>0&&e<t.length&&t[e].firstname.charAt(0)!==t[e-1].firstname.charAt(0)&&i.append('<div class="letter">'+t[e].firstname.charAt(0).toUpperCase()+"</div>")}function a(){var t={async:!0,crossDomain:!0,url:apiurl+"client/all/"+userid,method:"GET",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,statusCode:{200:function(t,n){clientlist=t,console.log(clientlist),i.empty(),0===clientlist.length?i.append("<div class=\"empty\">You don't have any clients, <br> Click the '+' below to get started!</div>"):e(t)},400:function(t,e){ErrorModal.populateMessage(t.responseText)},401:function(t,e){redirect("/")},500:function(t,e){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(t)}var i=$(".clientlist"),o=$(".clientprofile");!function(){a()}();return{clientListAJAX:a}}(),ReportIssue=function(){function t(){var t=new FormData;t.append("name",name),t.append("phone",phone),t.append("email",email),t.append("salon",salon),t.append("issue",n.val());var e={async:!0,crossDomain:!0,url:"https://script.google.com/macros/s/AKfycbxwK0uSZtglD0qBQKwqNOzfM-1JDMjIusr4FL3i6bkpAkL-QCOH/exec",method:"POST",processData:!1,contentType:!1,data:t,statusCode:{200:function(t,e){},400:function(t,e){ErrorModal.populateMessage(t.responseText)},401:function(t,e){redirect("/")},500:function(t,e){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(e)}var e=($(".reportmodal"),$(".reportmodal .confirmreport")),n=$(".issueform");e.click(function(){t()});return{}}(),ClientEdit=function(){function t(){f.val(o),m.val(r),h.val(l),g.text(s),d.attr("src",c),e(),p.modal("show")}function e(){v.hide(),w.hide(),C.show(),M.show()}function n(){v.show(),w.show(),C.hide(),M.hide()}function a(){o=$(".clientprofile .firstname").text(),r=$(".clientprofile .lastname").text(),l=$(".clientprofile .phone").text(),c=$(".clientprofile .photo").attr("src"),s=$(".clientprofile .notes").text(),d=$(".clientaddmodal .clientaddform .photothumb"),t()}function i(){var t=new FormData;t.append("firstname",f.val()),t.append("lastname",m.val()),t.append("phone",h.val()),t.append("notes",g.text()),PhotoUpload.getResizedImage()&&t.append("photo",PhotoUpload.getResizedImage()),PhotoUpload.getResizedAvatar()&&t.append("avatar",PhotoUpload.getResizedAvatar()),clientid=$(".clientprofile").attr("id");var e={async:!0,crossDomain:!0,url:apiurl+"client/edit/"+userid+"/"+clientid+"/",method:"PUT",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,mimeType:"multipart/form-data",data:t,statusCode:{200:function(t,e){ClientList.clientListAJAX(),ClientAdd.emptyAddForm(),p.modal("hide"),ClientAdd.hideLoading(),ClientNav.closeClientProfile(),n()},400:function(t,e){hideLoading(),ErrorModal.populateMessage(t.responseText)},401:function(t,e){hideLoading(),ErrorModal.populateMessage(t.responseText)},500:function(t,e){hideLoading(),ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(e)}var o,r,l,c,s,d,u=$(".clientprofile .editclient"),p=($("main .clientaddbutton"),$(".clientaddmodal")),f=($(".clientaddmodal .modal-footer"),$(".clientaddmodal .clientaddform"),$(".clientaddmodal .clientaddform .firstname")),m=$(".clientaddmodal .clientaddform .lastname"),h=$(".clientaddmodal .clientaddform .phone"),g=$(".clientaddmodal .clientaddform .notes"),v=$(".clientaddmodal .clientaddsubmit"),w=$(".clientaddmodal .closemodal"),C=$(".clientaddmodal .clienteditsubmit"),M=$(".clientaddmodal .closeeditmodal");$(".clientaddmodal .savingclient");u.click(function(){a()}),M.click(function(){n(),ClientAdd.emptyAddForm()}),C.click(function(){ClientAdd.showLoading(),i()});return{}}(),PhotoUpload=function(){function t(){m.click(function(){p.click()})}function e(){p=$(".photowidget .photoinput"),f=$(".photowidget .photobox"),m=$(".photobox img"),t(),n()}function n(){p.change(function(t){w=this.files[0];var e=window.location.href.split("/")[3];"clients"===e&&a(i,150,!0),"register"===e&&a(i,200,!1)})}function a(t,e,n){var a=new FileReader;a.onload=function(a){var i=new DataView(a.target.result);if(65496!=i.getUint16(0,!1))return v=-2,t(e,n);for(var o=i.byteLength,r=2;r<o;){var l=i.getUint16(r,!1);if(r+=2,65505==l){if(1165519206!=i.getUint32(r+=2,!1))return v=-1,t(e,n);var c=18761==i.getUint16(r+=6,!1);r+=i.getUint32(r+4,c);var s=i.getUint16(r,c);r+=2;for(var d=0;d<s;d++)if(274==i.getUint16(r+12*d,c))return v=i.getUint16(r+12*d+8,c),t(e,n)}else{if(65280!=(65280&l))break;r+=i.getUint16(r,!1)}}return v=-1,t(e,n)},a.readAsArrayBuffer(w)}function i(t,e){var n=document.createElement("canvas"),a=n.getContext("2d"),d=new Image;d.onload=function(){var u=d.width/d.height;if(1==v||"undefined"==typeof orentation)var p=o(t,u);if(3==v)var p=l(t,u);if(6==v)var p=r(t,u);if(8==v)var p=c(t,u);n.width=p.canvasW,n.height=p.canvasH,a.rotate(p.rotate),a.translate(p.translateX,p.translateY),a.save(),a.drawImage(d,0,0,p.drawImgX,p.drawImgY),a.restore(),!1===e&&(h=n.toDataURL(),s(h)),!0===e&&(g=n.toDataURL(),i(500,!1))},d.src=URL.createObjectURL(w)}function o(t,e){return{canvasW:t*e,canvasH:t,drawImgX:t*e,drawImgY:t,rotate:0,translateX:0,translateY:0}}function r(t,e){return{canvasW:t,canvasH:t*e,drawImgX:t*e,drawImgY:t,rotate:90*Math.PI/180,translateX:0,translateY:-t}}function l(t,e){return{canvasW:t*e,canvasH:t,drawImgX:t*e,drawImgY:t,rotate:180*Math.PI/180,translateX:-t*e,translateY:-t}}function c(t,e){return{canvasW:t,canvasH:t*e,drawImgX:t*e,drawImgY:t,rotate:-90*Math.PI/180,translateX:-t*e,translateY:0}}function s(t){m.attr("src",t)}function d(){return h}function u(){return g}var p,f,m,h,g,v,w,C=$(".photowidget");!function(){C&&C.load("/templates/photoupload.tpl.html",function(){e()})}();return{getResizedImage:d,getResizedAvatar:u,showImage:s}}();