function cookieCheck(){return!(!userid||!jwt)||(window.location.href=window.location.origin+"/",!1)}function redirect(n){window.location.href=window.location.origin+n}var userid=decodeURI($.cookie("userid")),jwt=decodeURI($.cookie("jwt")),name=decodeURI($.cookie("name")),phone=decodeURI($.cookie("phone")),email=decodeURI($.cookie("email")),salon=decodeURI($.cookie("salon")),ErrorModal=function(){function n(){t=$(".errormodal"),a=$(".errormodal .message"),i=$(".errormodal .dismiss"),i.click(function(){a.empty()})}function e(n){a.text(n),t.modal("show")}var t,a,i,o=$(".errormodalcontainer");!function(){o&&o.load("/templates/errormodal.tpl.html",function(){n()})}();return{populateMessage:e}}(),StylistProfile=function(){function n(n){if(0!==n){var e=50*(Math.round(2*n)/2).toFixed(1);$(".starbar").css("width",e)}else $(".ratingtitle").text("No Ratings Yet!"),$(".starbar").css("width",0)}function e(n){for(var e in n){$(".ratingscontainer .comments").append('<div class="starholder" id="star'+e+'"></div>');for(var t=0;t<n[e].stars;t++)$(".starholder#star"+e).append("&star;");$(".ratingscontainer .comments").append('<span class="comment">'+n[e].comment+"</span>")}}function t(){o.append('<div class="avatar"></div><span class="name">'+name+'</span><span class="phone">'+phone+'</span><span class="salon">'+salon+'</span><hr><div class="ratingscontainer">Fetching Rating<img src="/app/img/loading.gif"></div>'),$(".stylistprofile .avatar").css("background",'url("'+apiurl+"avatar/"+userid+'") no-repeat center')}function a(t){$(".ratingscontainer").empty(),$(".ratingscontainer").append('<span class="ratingtitle">5 Star Rating:</span><div class="rating"><div class="stargrid"><img src="/app/img/star.png"><img src="/app/img/star.png"><img src="/app/img/star.png"><img src="/app/img/star.png"><img src="/app/img/star.png"></div><div class="starbar"></div></div><hr><div class="comments"></div>'),n(t.total),e(t.raw)}function i(){var n={async:!0,crossDomain:!0,url:apiurl+"rating/"+userid,method:"GET",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,statusCode:{200:function(n,e){a(n)},400:function(n,e){ErrorModal.populateMessage(n.responseText)},401:function(n,e){redirect("/")},500:function(n,e){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(n)}var o=($(".stylistmodal"),$(".stylistprofile"));!function(){t()}();return{stylistRatingAJAX:i}}(),ClientAdd=function(){function n(){p.show()}function e(){p.hide()}function t(){$(".clientaddmodal .clientaddform input").each(function(){$(this).val("")}),l.val(""),$(".clientaddmodal .clientaddform .photothumb").css("background","none")}function a(){var n=new FormData;n.append("firstname",r.val()),n.append("lastname",c.val()),n.append("phone",s.val()),n.append("notes",l.val()),n.append("photo",$(".clientaddmodal .clientaddform .photoinput")[0].files[0],"photo.jpg"),n.append("name",name);var a={async:!0,crossDomain:!0,url:apiurl+"client/add/"+userid,method:"POST",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,mimeType:"multipart/form-data",data:n,statusCode:{200:function(n,a){ClientList.clientListAJAX(),t(),o.modal("hide"),e(),t()},400:function(n,t){e(),ErrorModal.populateMessage(n.responseText)},401:function(n,t){e(),ErrorModal.populateMessage(n.responseText)},500:function(n,t){e(),ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(a)}var i=$("main .clientaddbutton"),o=$(".clientaddmodal"),r=($(".clientaddmodal .clientaddform"),$(".clientaddmodal .clientaddform .firstname")),c=$(".clientaddmodal .clientaddform .lastname"),s=$(".clientaddmodal .clientaddform .phone"),l=$(".clientaddmodal .clientaddform .notes"),d=$(".clientaddmodal .clientaddsubmit"),u=$(".clientaddmodal .closemodal"),p=$(".clientaddmodal .savingclient");i.click(function(){o.modal("show")}),d.click(function(){n(),a()}),u.click(function(){t()}),$(document).keypress(":input:not(textarea)",function(n){return 13!=n.keyCode});return{}}(),ClientMenu=function(){function n(){a.show(),i.animate({top:50},300),s.animate({opacity:1},300),i.addClass("open")}function e(){i.animate({top:50-i.height()},300,function(){a.hide()}),s.animate({opacity:0},300),i.removeClass("open")}function t(){i.hasClass("open")?i.css("top",50):i.css("top",50-i.height())}var a=$(".clientmenu"),i=$(".clientmenu .menuitems"),o=$(".clientmenu .profile"),r=$(".clientmenu .report"),c=$(".clientmenu .logout"),s=$(".clientmenu .menuoverlay"),l=$(".stylistmodal"),d=$(".reportmodal");s.click(function(){e()}),o.click(function(){l.modal("show"),StylistProfile.stylistRatingAJAX(),e()}),r.click(function(){d.modal("show"),e()}),c.click(function(){$.removeCookie("jwt",{path:"/"}),$.removeCookie("userid",{path:"/"}),$.removeCookie("name",{path:"/"}),$.removeCookie("phone",{path:"/"}),$.removeCookie("email",{path:"/"}),$.removeCookie("salon",{path:"/"}),window.location.href=window.location.origin+"/"}),$(window).on("resize",function(){t()});return{openMenu:n,closeMenu:e}}(),ClientNav=function(){function n(){k.animate({left:"100vw"},500,function(){k.scrollTop(0)}),i(),t()}function e(){h.fadeOut(),g.hide()}function t(){h.fadeIn(),g.show()}function a(){v.fadeIn()}function i(){v.fadeOut()}function o(){var n=$(window).width()-40;f.fadeOut(300),m.fadeOut(300),w.fadeIn(300),u(),g.addClass("open"),h.animate({right:"+="+(n-10)+"px"},300,function(){g.show(),g.focus()})}function r(){g.blur();$(window).width();f.fadeIn(300),m.fadeIn(300),w.fadeOut(300),g.removeClass("open"),h.animate({right:"10px"},300,function(){d(),g.val(""),g.trigger("keyup")})}function c(){m.fadeIn(),f.fadeIn(),h.hide(),w.hide(),h.css("right","10px"),g.removeClass("open")}function s(){setTimeout(function(){g.val(""),g.trigger("keyup"),d()},300)}function l(){var n=$(window).width()-30;h.css("right",n-10)}function d(){$(".clientlist .letter").each(function(){$(this).fadeIn(300)})}function u(){$(".clientlist .letter").each(function(){$(this).fadeOut(300)})}function p(n,e){return-1!=n.toLowerCase().indexOf(e.toLowerCase())}var f=$(".clientnav .hamburger"),m=$(".clientnav .navlogo"),h=$(".clientnav .navsearch"),g=$(".clientnav .searchfield"),v=$(".clientnav .exitprofile"),w=$(".clientnav .cancelsearch"),C=$(".clientmenu .menuitems"),k=$(".clientprofile");f.click(function(){C.hasClass("open")?ClientMenu.closeMenu():ClientMenu.openMenu()}),v.click(function(){n(),C.hasClass("open")&&ClientMenu.closeMenu()}),g.click(function(){g.hasClass("open")?r():o(),C.hasClass("open")&&ClientMenu.closeMenu()}),$(window).on("resize",function(){g.hasClass("open")&&l()}),g.keyup(function(){var n=$(this).val();$(".clientlist .clientcard").each(function(){$(this).toggle(p($(this).data("name"),n))})}),w.click(function(){r()});return{hideSearch:e,showBackBtn:a,quickClearSearch:c,restoreList:s,closeClientProfile:n}}(),ClientProfile=function(){function n(n){a.attr("id",n._id),i.attr("src",apiurl+"photo/"+n.userid+"/"+n._id+"/avatar.jpg"),o.text(n.firstname),r.text(n.lastname),c.html('<a href="tel:'+n.phone+'">'+n.phone+"</a>"),s.attr("src",apiurl+"photo/"+n.userid+"/"+n._id+"/photo.jpg"),l.val(n.notes)}function e(){u.modal("show")}function t(){var n=a.attr("id"),e={async:!0,crossDomain:!0,url:apiurl+"client/delete/"+userid+"/"+n,method:"DELETE",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,statusCode:{200:function(n,e){ClientList.clientListAJAX(),ClientNav.closeClientProfile()},400:function(n,e){ErrorModal.populateMessage(n.responseText)},401:function(n,e){redirect("/")},500:function(n,e){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(e)}var a=$(".clientprofile"),i=$(".clientprofile .avatar"),o=$(".clientprofile .firstname"),r=$(".clientprofile .lastname"),c=$(".clientprofile .phone"),s=$(".clientprofile .photo"),l=$(".clientprofile .notes"),d=$(".clientprofile .deleteclient"),u=$(".deleteModal"),p=$(".deleteModal .confirmDelete");d.click(function(){e()}),p.click(function(){t()});return{populateProfile:n}}(),ClientList=function(){function n(){$(".clientcard").each(function(){$(this).click(function(){ClientProfile.populateProfile(clientlist[$(this).attr("id")]),ClientNav.quickClearSearch(),o.animate({left:"0"},500,function(){ClientNav.restoreList(),i.scrollTop(0)}),ClientNav.hideSearch(),ClientNav.showBackBtn()})})}function e(e){for(var a in e)t(e,a),i.append('<div class="clientcard" id="'+a+'" data-name="'+e[a].firstname+e[a].lastname+'"><div class="avatar"><img src="'+apiurl+"photo/"+userid+"/"+e[a]._id+'/avatar.jpg"></div><span class="firstname">'+e[a].firstname+'</span><span class="lastname"> '+e[a].lastname+"</span></div>");n()}function t(n,e){"0"===e&&i.append('<div class="letter">'+n[e].firstname.charAt(0)+"</div>"),e>0&&e<n.length&&n[e].firstname.charAt(0)!==n[e-1].firstname.charAt(0)&&i.append('<div class="letter">'+n[e].firstname.charAt(0).toUpperCase()+"</div>")}function a(){var n={async:!0,crossDomain:!0,url:apiurl+"client/all/"+userid,method:"GET",headers:{"cache-control":"no-cache",Authorization:"Bearer "+jwt},processData:!1,contentType:!1,statusCode:{200:function(n,t){clientlist=n,i.empty(),0===clientlist.length?i.append("<div class=\"empty\">You don't have any clients, <br> Click the '+' below to get started!</div>"):e(n)},400:function(n,e){ErrorModal.populateMessage(n.responseText)},401:function(n,e){redirect("/")},500:function(n,e){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(n)}var i=$(".clientlist"),o=$(".clientprofile");!function(){a()}();return{clientListAJAX:a}}(),ReportIssue=function(){function n(){var n=new FormData;n.append("name",name),n.append("phone",phone),n.append("email",email),n.append("salon",salon),n.append("issue",t.val());var e={async:!0,crossDomain:!0,url:"https://script.google.com/macros/s/AKfycbxwK0uSZtglD0qBQKwqNOzfM-1JDMjIusr4FL3i6bkpAkL-QCOH/exec",method:"POST",processData:!1,contentType:!1,data:n,statusCode:{200:function(n,e){},400:function(n,e){ErrorModal.populateMessage(n.responseText)},401:function(n,e){redirect("/")},500:function(n,e){ErrorModal.populateMessage("Hairbrain isn't working right now. Please try again later.")}}};$.ajax(e)}var e=($(".reportmodal"),$(".reportmodal .confirmreport")),t=$(".issueform");e.click(function(){n()});return{}}(),PhotoUpload=function(){function n(){s.click(function(){r.click(),t()})}function e(){r=$(".photowidget .photoinput"),c=$(".photowidget .photobox"),s=$(".photowidget .photothumb"),n()}function t(){r.change(function(n){a(this.files[0])})}function a(n){ImageTools.resize(n,{width:400,height:300},function(n,e){i(n)})}function i(n){var e=new FileReader;e.onload=function(){var t=new Image;t.onload=function(){o(t,n)},t.src=e.result},e.readAsDataURL(n)}function o(n,e){n.height<n.width?(s.removeClass("default"),s.addClass("rotate")):(s.removeClass("rotate"),s.addClass("default")),s.css("background","url("+n.src+") no-repeat center"),s.css("background-size","cover")}var r,c,s,l=$(".photowidget");!function(){l&&l.load("/templates/photoupload.tpl.html",function(){e()})}();return{}}();